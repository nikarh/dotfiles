timezone: Europe/Riga

sources:
  sftp-logs:
    type: docker_logs
    include_images: ["atmoz/sftp"]
  docker-logs:
    type: docker_logs
    exclude_containers: ["loki", "grafana"]

transforms:
  sftp-parsed:
    type: remap
    inputs: ["sftp-logs"]
    source: '.message, _ = format_timestamp(.timestamp, "%b %d %H:%M:%S", "Europe/Riga") + " files sshd: " + .message'

sinks:
  sftp-file:
    type: file
    inputs: ["sftp-parsed"]
    path: /out/sftp.log
    encoding:
      codec: text
  victorialogs:
    type: elasticsearch
    inputs: ["docker-logs"]
    endpoints: ["http://victoria-logs:9428/insert/elasticsearch/"]
    mode: "bulk"
    api_version: "v8"
    compression: "gzip"
    query:
      _msg_field: "message"
      _time_field: "timestamp"
      _stream_fields: "container_name,source_type,stream"
